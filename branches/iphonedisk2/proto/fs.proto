// Author: Allen Porter <allen@thebends.org>

package proto;

message Header {
  required string fs_id = 1;
}

message Status {
  required bool success = 1;
  optional string status_detail = 2;
}

message GetAttrRequest {
  required Header header = 1;
  required string path = 2;
}

message GetAttrResponse {
  required Status status = 1;

  message Stat {
    required int64 size = 1;
    required int64 blocks = 2;
    required int64 mode = 3;
    required int64 nlink = 4;
  }
  optional Stat stat = 2;
}

message ReadDirRequest {
  required Header header = 1;
  required string path = 2;
}

message ReadDirResponse {
  required Status status = 1;
  message Entry {
    required string filename = 1;
  }
  repeated Entry entry = 2;
}

message UnlinkRequest {
  required Header header = 1;
  required string path = 2;
}

message UnlinkResponse {
  required Status status = 1;
}

message MkDirRequest {
  required Header header = 1;
  required string path = 2;
}

message MkDirResponse {
  required Status status = 1;
}

message RenameRequest {
  required Header header = 1;
  required string source_path = 2;
  required string destination_path = 3;
}

message RenameResponse {
  required Status status = 1;
}

message OpenRequest {
  required Header header = 1;
  required string path = 2;
  enum Mode {
    READ = 1;
    WRITE = 2;
  }
  required Mode mode = 3;
}

message OpenResponse {
  required Status status = 1;
  optional int64 filehandle = 2;
}

message CreateRequest {
  required Header header = 1;
  required string path = 2;
}

message CreateResponse {
  required Status status = 1;
  optional int64 filehandle = 2;
}

message ReleaseRequest {
  required Header header = 1;
  required int64 filehandle = 2;
}

message ReleaseResponse {
  required Status status = 1;
}

message ReadRequest {
  required Header header = 1;
  required int64 filehandle = 2;
  required int64 size = 3;
  required int64 offset = 4;
}

message ReadResponse {
  required Status status = 1;
  optional string buffer = 2;
}

message WriteRequest {
  required Header header = 1;
  required int64 filehandle = 2;
  required int64 offset = 3;
  required string buffer = 4;
}

message WriteResponse {
  required Status status = 1;
}

message TruncateRequest {
  required Header header = 1;
  required string path = 2;
  required int64 offset = 3;
}

message TruncateResponse {
  required Status status = 1;
}

message StatFsRequest {
  required Header header = 1;
}

message StatFsResponse {
  required Status status = 1;
  message Stat {
    required int64 bsize = 1;
    required int64 fsrize = 2;
    required int64 blocks = 3;
    required int64 bfree = 4;
  }
  optional Stat stat = 2;
}
